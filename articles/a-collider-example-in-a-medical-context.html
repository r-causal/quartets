<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="quartets">
<title>A collider example in a medical context • quartets</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A collider example in a medical context">
<meta property="og:description" content="quartets">
<meta property="og:image" content="https://r-causal.github.io/quartets/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">quartets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a-collider-example-in-a-medical-context.html">A collider example in a medical context</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-causal/quartets/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A collider example in a medical context</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-causal/quartets/blob/HEAD/vignettes/a-collider-example-in-a-medical-context.Rmd" class="external-link"><code>vignettes/a-collider-example-in-a-medical-context.Rmd</code></a></small>
      <div class="d-none name"><code>a-collider-example-in-a-medical-context.Rmd</code></div>
    </div>

    
    
<p>This article walks through a specific medical example of a potential
collider, building on the example laid out by Luque-Fernandez et al
(2019) in <a href="https://doi.org/10.1093/ije/dyy275" class="external-link"><em>Paradoxical
collider effect in the analysis of non-communicable disease
epidemiological data: a reproducible illustration and web
application</em></a>. Here, we use the <code>causal_collider</code> and
<code>causal_collider_time</code> data sets, but suppose that the
<code>exposure</code> is sodium intake, the <code>outcome</code> is
systolic blood pressure (SBP), and the <code>covariate</code> is urinary
protein excretion (proteinuria).</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p><strong>Causal Question</strong>: What is the average treatment
effect of 24-hour dietary sodium intake (in grams) on systolic blood
pressure?</p>
<p><strong>Available data</strong>: We have a data set with three
variables <code>exposure</code> (sodium intake in grams),
<code>outcome</code> (systolic blood pressure) and
<code>covariate</code> (24-hour excretion of urinary protein,
proteinuria)</p>
<p><strong>The truth</strong>: Because this is simulated data, we know
the true relationship between sodium intake and systolic blood pressure.
In this case the estimated average treatment effect should be
<em>1</em>.</p>
<p>Let’s begin by examining the data. We will additionally load the
<code>tidyverse</code> package, which we will use for data visualization
and manipulation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/quartets" class="external-link">quartets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">causal_collider</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 3</span></span></span>
<span><span class="co">#&gt;    exposure outcome covariate</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   0.486   1.71       2.24 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   0.065<span style="text-decoration: underline;">3</span>  0.669      0.924</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  -<span style="color: #BB0000;">1.40</span>   -<span style="color: #BB0000;">1.60</span>      -<span style="color: #BB0000;">0.999</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  -<span style="color: #BB0000;">0.546</span>  -<span style="color: #BB0000;">1.73</span>      -<span style="color: #BB0000;">2.34</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  -<span style="color: #BB0000;">0.401</span>   0.617      0.207</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  -<span style="color: #BB0000;">2.38</span>   -<span style="color: #BB0000;">2.15</span>      -<span style="color: #BB0000;">3.62</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   0.652   0.585      0.799</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  -<span style="color: #BB0000;">0.574</span>   0.706     -<span style="color: #BB0000;">1.31</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   1.19    1.52       1.16 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  -<span style="color: #BB0000;">0.664</span>   0.018<span style="text-decoration: underline;">1</span>    -<span style="color: #BB0000;">1.89</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>To further help us remain in the real-world example, we can assume
these are normalized versions of these variables (as negative values
otherwise would not make sense).</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>We can examine the univariate effect of the exposure on the outcome
via a scatterplot.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">causal_collider</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">exposure</span>, y <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="st">"y ~ x"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sodium intake"</span>, y <span class="op">=</span> <span class="st">"Systolic blood pressure"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a-collider-example-in-a-medical-context_files/figure-html/scatterplot-1.png" width="700"></p>
<p>We see a positive relationship between unadjusted 24-hour sodium
intake and systolic blood pressure.</p>
<p>How should we estimate this average treatment effect? The first step
is to draw the proposed causal diagram. As the motivating paper
explains, “high levels of 24-h excretion of urinary protein
(proteinuria) are caused by sustained high SBP [systolic blood pressure]
and increased 24-h dietary sodium intake. Therefore, … proteinuria acts
as a collider. In a realistic scenario, one might control for
proteinuria if physiological factors influencing SBP are not completely
understood by the researcher, the relationships between variables are
not depicted in a DAG or proteinuria is conceptualized as a confounder.
Controlling for proteinuria introduces collider bias.” (Luque-Fernandez
et al 2019).</p>
<p>Let’s suppose we initially erroneously believe that proteinuria is a
<em>confounder</em>, that is, we believe it should be adjusted for in
the analysis. For continuous exposures, the correlation between the
exposure and potential confounder is a recommended way to assess balance
(<a href="https://doi.org/10.1515/jci-2014-0022" class="external-link">Zhu et al. 2014</a>).
Let’s examine the pre-adjustment correlation between the
<code>exposure</code> and <code>covariate</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_collider</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">exposure</span>, <span class="va">covariate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   `cor(exposure, covariate)`</span></span>
<span><span class="co">#&gt;                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                      0.700</span></span></code></pre></div>
<p>We observe a strong, positive, correlation between sodium intake and
proteinuria. This is well above the rule of thumb for achieving balance
of |0.1| (<a href="https://doi.org/10.1515/jci-2014-0022" class="external-link">Zhu et
al. 2014</a>).</p>
<p>There are several methods for estimating average treatment effects of
continuous exposures, such as inverse probability weighting or
g-computation. Let’s use inverse probability weighting. We will begin by
creating these weights.</p>
<p>The first step is to calculate the propensity score model, which will
be used in the denominator of the weight. That is, we are building a
model to predict sodium intake from proteinuria
(<code>denominator_model</code>). We then plug the fitted values from
the model into a Gaussian density along with the residual standard
deviation, as seen in the second portion of the code below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">denominator_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">exposure</span> <span class="op">~</span> <span class="va">covariate</span>, </span>
<span>  data <span class="op">=</span> <span class="va">causal_collider</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">denominators</span> <span class="op">&lt;-</span> <span class="va">causal_collider</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    propensity_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">denominator_model</span><span class="op">)</span>,</span>
<span>    denominator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span></span>
<span>      <span class="va">exposure</span>, </span>
<span>      <span class="va">propensity_score</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">denominator_model</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">denominator</span><span class="op">)</span> </span></code></pre></div>
<p>We then fit the numerator of the weights for stability. The average
exposure value is plugged into a Gaussian density along with the
residual standard deviation, as seen in the second portion of the code
below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numerator_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">exposure</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>  data <span class="op">=</span> <span class="va">causal_collider</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">numerators</span> <span class="op">&lt;-</span> <span class="va">causal_collider</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    mean_exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">numerator_model</span><span class="op">)</span>,</span>
<span>    numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span></span>
<span>      <span class="va">exposure</span>, </span>
<span>      <span class="va">mean_exposure</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">numerator_model</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">numerator</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">causal_collider_wts</span> <span class="op">&lt;-</span> <span class="va">causal_collider</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>swts <span class="op">=</span> <span class="va">numerators</span> <span class="op">/</span> <span class="va">denominators</span><span class="op">)</span></span></code></pre></div>
<p>We can examine the distribution of these weights:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">causal_collider_wts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">swts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p><img src="a-collider-example-in-a-medical-context_files/figure-html/wts-1.png" width="700"></p>
<p>We can then examine the weighted correlation to assess the balance
after incorporating the propensity score weight.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_collider_wts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    exposure_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="va">exposure</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span><span class="op">)</span>,</span>
<span>    covariate_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="va">covariate</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span><span class="op">)</span>,</span>
<span>    numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">exposure</span> <span class="op">-</span> <span class="va">exposure_w</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">covariate</span> <span class="op">-</span> <span class="va">covariate_w</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    denom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">exposure</span> <span class="op">-</span> <span class="va">exposure_w</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">covariate</span> <span class="op">-</span> <span class="va">covariate_w</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    weighted_cor <span class="op">=</span> <span class="va">numerator</span><span class="op">/</span><span class="va">denom</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">weighted_cor</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   weighted_cor</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       -<span style="color: #BB0000;">0.204</span></span></span></code></pre></div>
<p>Now the weighted correlation is -0.2 (not less than the target,
|0.1|, but improved over the unadjusted correlation of 0.7 and the best
we can do with this data).</p>
<p>Now that we have assessed balance, let’s fit our outcome model and
estimate the average treatment effect of sodium intake on systolic blood
pressure.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">exposure</span>, data <span class="op">=</span> <span class="va">causal_collider_wts</span>, weight <span class="op">=</span> <span class="va">swts</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = outcome ~ exposure, data = causal_collider_wts, </span></span>
<span><span class="co">#&gt;     weights = swts)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)     exposure  </span></span>
<span><span class="co">#&gt;      0.3284       0.3438</span></span></code></pre></div>
<p>Oh no! This claims that the estimated average treatment effect is
0.34 (we know the true effect should be 1).</p>
</div>
<div class="section level2">
<h2 id="analysis-incorporating-time-varying-data">Analysis incorporating time varying data<a class="anchor" aria-label="anchor" href="#analysis-incorporating-time-varying-data"></a>
</h2>
<p>Luckily, we have some data that includes the <em>timing</em> of our
measurements. We know that we should only be adjusting for factors that
were measured <em>prior to the exposure</em> (i.e., we want to adjust
for proteinuria at <em>baseline</em> not at <em>follow-up</em>). Let’s
look at the time varying dataset:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_collider_time</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 6</span></span></span>
<span><span class="co">#&gt;    exposure_baseline outcome_baseline covariate_baseline exposure_followup</span></span>
<span><span class="co">#&gt;                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>          -<span style="color: #BB0000;">1.43</span>              0.287             -<span style="color: #BB0000;">0.096</span><span style="color: #BB0000; text-decoration: underline;">3</span>          -<span style="color: #BB0000;">1.53</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           0.059<span style="text-decoration: underline;">3</span>           -<span style="color: #BB0000;">0.978</span>             -<span style="color: #BB0000;">1.11</span>            -<span style="color: #BB0000;">0.278</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           0.370             0.348              0.647           -<span style="color: #BB0000;">0.004</span><span style="color: #BB0000; text-decoration: underline;">64</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           0.004<span style="text-decoration: underline;">71</span>           0.851              0.755           -<span style="color: #BB0000;">0.806</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           0.340             1.94               1.19            -<span style="color: #BB0000;">0.276</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>          -<span style="color: #BB0000;">3.61</span>             -<span style="color: #BB0000;">0.235</span>             -<span style="color: #BB0000;">0.588</span>           -<span style="color: #BB0000;">5.29</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           1.44             -<span style="color: #BB0000;">0.827</span>             -<span style="color: #BB0000;">1.13</span>             1.52   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           1.02             -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">0</span>             0.689            1.12   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>          -<span style="color: #BB0000;">2.43</span>             -<span style="color: #BB0000;">2.10</span>              -<span style="color: #BB0000;">1.49</span>            -<span style="color: #BB0000;">3.94</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>          -<span style="color: #BB0000;">1.26</span>             -<span style="color: #BB0000;">2.41</span>              -<span style="color: #BB0000;">2.78</span>            -<span style="color: #BB0000;">0.442</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: outcome_followup &lt;dbl&gt;, covariate_followup &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Let’s suppose we still erroneously think proteinuria is a confounder,
but we carefully only adjust for it at baseline. Let’s begin by
examining balance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_collider_time</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">exposure_baseline</span>, <span class="va">covariate_baseline</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   `cor(exposure_baseline, covariate_baseline)`</span></span>
<span><span class="co">#&gt;                                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                                        0.324</span></span></code></pre></div>
<p>We still observe a positive relationship greater than our rule of
thumb (|0.1|). Now let’s create our propensity score weights.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">denominator_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">exposure_baseline</span> <span class="op">~</span> <span class="va">covariate_baseline</span>, </span>
<span>  data <span class="op">=</span> <span class="va">causal_collider_time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">denominators</span> <span class="op">&lt;-</span> <span class="va">causal_collider_time</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    propensity_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">denominator_model</span><span class="op">)</span>,</span>
<span>    denominator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span></span>
<span>      <span class="va">exposure_baseline</span>, </span>
<span>      <span class="va">propensity_score</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">denominator_model</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">denominator</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">numerator_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">exposure_baseline</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>  data <span class="op">=</span> <span class="va">causal_collider_time</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">numerators</span> <span class="op">&lt;-</span> <span class="va">causal_collider_time</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    mean_exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">numerator_model</span><span class="op">)</span>,</span>
<span>    numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span></span>
<span>      <span class="va">exposure_baseline</span>, </span>
<span>      <span class="va">mean_exposure</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">numerator_model</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">numerator</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">causal_collider_wts</span> <span class="op">&lt;-</span> <span class="va">causal_collider_time</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>swts <span class="op">=</span> <span class="va">numerators</span> <span class="op">/</span> <span class="va">denominators</span><span class="op">)</span></span></code></pre></div>
<p>We can again examine the distribution of these weights:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">causal_collider_wts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">swts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p><img src="a-collider-example-in-a-medical-context_files/figure-html/wts-2-1.png" width="700"></p>
<p>We can then examine the weighted correlation to assess balance the
balance after incorporating the propensity score weight.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">causal_collider_wts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    exposure_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="va">exposure_baseline</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span><span class="op">)</span>,</span>
<span>    covariate_w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="va">covariate_baseline</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span><span class="op">)</span>,</span>
<span>    numerator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">exposure_baseline</span> <span class="op">-</span> <span class="va">exposure_w</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">covariate_baseline</span> <span class="op">-</span> <span class="va">covariate_w</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    denom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">exposure_baseline</span> <span class="op">-</span> <span class="va">exposure_w</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swts</span> <span class="op">*</span> <span class="op">(</span><span class="va">covariate_baseline</span> <span class="op">-</span> <span class="va">covariate_w</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    weighted_cor <span class="op">=</span> <span class="va">numerator</span><span class="op">/</span><span class="va">denom</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">weighted_cor</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   weighted_cor</span></span>
<span><span class="co">#&gt;          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       0.047<span style="text-decoration: underline;">6</span></span></span></code></pre></div>
<p>Great! We have acheived balance (i.e., the weighted correlation is
less than the rule of thumb, |0.1|).</p>
<p>Now that we have assessed balance, let’s fit our outcome model and
estimate the average treatment effect of sodium intake on systolic blood
pressure. Note that we are careful to use the <em>follow-up</em>
measurement for the outcome.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">outcome_followup</span> <span class="op">~</span> <span class="va">exposure_baseline</span>, data <span class="op">=</span> <span class="va">causal_collider_wts</span>, weight <span class="op">=</span> <span class="va">swts</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = outcome_followup ~ exposure_baseline, data = causal_collider_wts, </span></span>
<span><span class="co">#&gt;     weights = swts)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)  exposure_baseline  </span></span>
<span><span class="co">#&gt;          -0.07298            1.03421</span></span></code></pre></div>
<p>And wonderful! Even though we <em>erroneously</em> adjusted for
proteinuria (it is not actually a confounder!), since it was the
<em>baseline</em> measurement, we no longer induced collider bias.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lucy D’Agostino McGowan.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
